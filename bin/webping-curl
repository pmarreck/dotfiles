#!/usr/bin/env bash

# Wrapper script for webping to handle complex curl commands with proper headers
# Usage: webping-curl <url>

# Source shared function for bot-detection-resistant curl arguments
source "${BASH_SOURCE[0]%/*}/src/_get_bot_detection_resistant_curl_args_for_site.bash"

url="$1"

if [[ -z "$url" ]]; then
    echo "Usage: webping-curl <url>" >&2
    exit 1
fi

curl_args=$(get_curl_args "$url")

# Timeouts to avoid hanging. Override with WEBPING_CONNECT_TIMEOUT and WEBPING_MAX_TIME
CONNECT_TIMEOUT="${WEBPING_CONNECT_TIMEOUT:-5}"
MAX_TIME="${WEBPING_MAX_TIME:-20}"

# Do not use -f so HTTP errors still count as a timed sample.
# Build an array from the args string to avoid eval/quoting issues.
declare -a ARGS
read -r -a ARGS <<< "$curl_args"

curl -L -s -o /dev/null --connect-timeout "$CONNECT_TIMEOUT" --max-time "$MAX_TIME" "${ARGS[@]}" "$url" >/dev/null 2>&1 || true
exit 0
